# Описание задачи
Необходимо создать модель поиска _фродовых операций_ для всех продуктов по всем ТБ из _Мотивации_.  
Требования:  
- Для обучения использовать все продукты из _Мотивации_ за период с 01.07.2021 по 31.12.2021  
- Разметку из _Мотивации_ считать истинной, даже если не так, но при этом мы стремимся улучшить ту модель, что делает эту разметку  
- Predict сделать сначала на январских данных, потом результат модели проверят аналитики и уже с учётом этого сделать predict на февральских данных (не очень понятно, что предполагается, то ли дообучение нейронки, то ли заново обучить модель, но уже на январских данных)

P.S.: Также при тестировании моделей (файл baseline) оказалось, что признаки _DESCRIPTION_ и _IN_MOTIV_ сильно коррелируют с таргетом (возможно, вообще на  основе них была построена алгоритмическая модель).
    
## Выгрузки:
__План минимум:__  
    Выгрузить признаки из _Мотивации_ + даты рождения клиента и сотрудника (для возраста) +  столбцы _Табельный_клиента_ и _Отпуск_ для проверки является ли клиент сотрудником и был ли сотрудник в этот момент в отпуске (Скрипт для такой выгрузки отправляла Виктору).  
    Для обучения файлы из _Мотивации_: _MSAP_part{i}_ и _client_product_since20210101.csv_.  
    Второй файл служит для расчёта количества продуктов у клиента на момент оформления нового за последние 3 месяца (181 день).  
> В итоге реализован был именно этот вариант. Обучить изначально получилось вариант _План - больше признаков_, но сделать predict для такого варианта не успели, так как выгрузки для новых признаков требовали слишком много времени, а по важности, как оказалось, были последними.
Возможно, это связано как раз с тем, что модель, которая размечала эти данные, не использовала признаки фин связей.

__План - больше признаков:__  
Добавить ФИН связи. Для обучения файлы: *Cl_to_emp* и *emp_to_cl*  
Добавленные признаки:  
 - _empcl_amt_ - сумма всех переводов от сотрудника -> клиенту и аналогично от клиента -> сотруднику _clemp_amt_  
 - _empcl_diff_dates_before_ ближайшая дата перевода до продажи  от сотрудника -> клиенту и аналогично от клиента -> сотруднику _clemp_diff_dates_before_  
 - _empcl_diff_dates_after_ ближайшая дата перевода после продажи от сотрудника -> клиенту и аналогично от клиента -> сотруднику _clemp_diff_dates_after_  

__План - ещё больше признаков:__  
Добавить информацию из _Backoffice_. Файлы  _Emp_info_ и _client_info_.  

# Описание модели
В файле _**preprocessing**_ подготавливается dataset для обучения.
В файле _**baseline**_ была попытка применить _Ridge_, но из-за порядковой кодировки категориальных переменных с помощью _OrdinalEncode_ не было замечено крреляции признаков _DESCRIPTION_ и _IN_MOTIV_ с таргетом.  
Дальше попыталась применить векторизацию категориальных признаков, но из-за огромного числа значений оперативную память необходимую для модели придётся терабайтами считать))  
Ну и относительно этого всего _catboost_ справляется с задачей отлично.  
В файле _**Tuning_catboost+new_features**_ добавляются признаки ФИН связей для обучения, и также все незаполненные значения для возраста клиента и сотрудника заменяются на средний возраст. 
Данные для обучения сохранены в файле _dataset_2_ (файл _dataset_1_ промежуточная версия).
После чего была неуспешная попытка применить grid_search, в связи с чем я просто опробовала шесть моделей и сравнила по ним метрики: `learning_rate = [0.1, 0.01]` и `depth = [4, 6, 10]`.
К сожалению, перед очередным крахом контейнера я не успела запушить код, но лучшую модель _depth10_lr0_1_ загрузила.  
Ну и для предсказаний модели на январе написан файл _**Predict**_, в котором сначала  подготавливаются признаки для январских данных, а потом загружается модель и делается predict. 
Файлы выгрузки из _Мотивации_ сохранены в другом репозитории, чтобы ещё больше не загружать этот, в этом сохранён уже конечный dataset _Jan_dataset_2_.
